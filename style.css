:root{
  --bg:#0b1224; --panel:#0f172a; --stroke:#1f2a44; --text:#e5e7eb; --muted:#9ca3af;
  --tileA:#0e2a1e; --tileB:#123022; --block:#15223b;
  --player:#3b82f6; --enemy:#ef4444; --coin:#facc15; --shadow:#0006; --hpBack:#1f2937;
  --accent:#7c3aed; --rare:#60a5fa; --epic:#a78bfa; --legend:#f59e0b;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--panel);border-bottom:1px solid var(--stroke)}
header .muted{color:var(--muted);margin-left:8px}
header button{background:#26325a;color:#fff;border:1px solid #31406e;border-radius:8px;padding:6px 10px;cursor:pointer}
header button:hover{filter:brightness(1.05)}
main{
  max-width: 1400px;
  margin:14px auto;
  padding:12px;
  background:var(--panel);
  border:1px solid var(--stroke);
  border-radius:12px;
  position:relative
}
#game{display:block;width:100%;height:auto;border-radius:10px;border:1px solid var(--stroke);background:#0a1630;image-rendering:pixelated;touch-action:manipulation}
.help{margin:.6rem 0 0;color:#a1a1aa}
#status{margin-top:8px;color:var(--muted)}
.fab{position:fixed;bottom:14px;width:56px;height:56px;border-radius:50%;border:1px solid #31406e;background:var(--accent);color:#fff;font-size:24px;line-height:56px;text-align:center;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:20}
#btnUsePotion{ right:14px }
#btnAttack{ right:82px }
#btnLoot{ right:150px; display:none }
#atkCdCanvas{ position:fixed; right:82px; bottom:14px; width:56px; height:56px; z-index:21; pointer-events:none }
.err{position:fixed;left:50%;top:70px;transform:translateX(-50%);background:#7f1d1d;color:#fff;border:1px solid #fecaca;border-radius:8px;padding:8px 12px;z-index:50;font-weight:600;max-width:90vw;white-space:pre-wrap}

/* Quest */
.quest{position: fixed; top: 16px; right: 16px; width: 280px;background:#0f172a; border:1px solid #1f2a44; border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,.35); z-index:30}
.hidden{display:none}
.q-header{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid #1f2a44;font-weight:600}
.q-close{width:28px;height:28px;border-radius:6px;border:1px solid #31406e;background:#26325a;color:#fff;font-size:16px;cursor:pointer}
.q-body{padding:10px}
.q-title{font-weight:700;margin-bottom:6px}
.q-desc{color:#c7cad1;margin-bottom:8px}
.q-row{display:flex;justify-content:space-between;align-items:center;margin:8px 0}
.progress{width:100%;height:10px;background:#0b1224;border:1px solid #1f2a44;border-radius:6px;overflow:hidden}
.progress>div{height:100%;background:var(--accent);width:0%}
.q-reward{color:#d1fae5;margin-top:6px;font-size:13px}
.q-claim{width:100%;margin-top:10px;padding:8px 10px;border:1px solid #31406e;background:#2563eb;color:#fff;border-radius:8px;cursor:pointer}
.q-claim:disabled{background:#1f2a44;color:#9aa0ad;cursor:not-allowed}

/* Mini mappa */
#miniWrap{position:fixed; top:90px; right:16px; background:#0f172a; border:1px solid #1f2a44;border-radius:10px; padding:6px; z-index:25; box-shadow:0 10px 20px rgba(0,0,0,.35)}
#mini{ display:block; width:160px; height:96px; image-rendering:pixelated }
#btnMini{ margin-left:8px }

/* Hotbar */
.hotbar{position:fixed; left:50%; transform:translateX(-50%); bottom:80px; display:flex; gap:8px; z-index:22;background:rgba(15,23,42,.85); border:1px solid #1f2a44; padding:6px 8px; border-radius:12px; backdrop-filter: blur(4px);}
.slot{width:52px; height:52px; border:1px solid #31406e; border-radius:10px;display:grid; place-items:center; background:#111b36; position:relative; cursor:pointer; user-select:none;}
.slot:active{ transform:scale(0.98) }
.slot .lbl{ position:absolute; left:4px; top:2px; font:700 11px system-ui; color:#93c5fd }
.slot .cnt{ position:absolute; right:4px; bottom:2px; font:700 12px system-ui; color:#e5e7eb; text-shadow:0 1px 2px #000 }
.slot .cap{ font-size:20px }

/* Loot window */
.loot{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);width:320px; max-width:92vw; background:#0f172a; border:1px solid #1f2a44; border-radius:12px;box-shadow:0 16px 40px rgba(0,0,0,.45); z-index:40;}
.loot-h{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #1f2a44;font-weight:700}
.loot-x{width:32px;height:26px;border-radius:6px;border:1px solid #31406e;background:#26325a;color:#fff;cursor:pointer}
.loot-b{padding:10px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.itm{border:1px solid #2a355c;border-radius:10px;background:#0b1224;display:grid;place-items:center;padding:10px;cursor:pointer;position:relative;min-height:72px}
.itm .lbl{position:absolute;left:6px;top:6px;font:700 11px system-ui;color:#93c5fd}
.itm .nm{margin-top:6px;font-size:12px;color:#e5e7eb;text-align:center}
.itm .ico{font-size:22px}
.r-com{outline:1px solid #334155}
.r-uncommon{outline:1px solid var(--rare)}
.r-rare{outline:1px solid var(--epic)}
.r-legend{outline:1px solid var(--legend)}
.loot-f{display:flex;gap:8px;justify-content:flex-end;padding:10px;border-top:1px solid #1f2a44}
.btn{border:1px solid #31406e;background:#2563eb;color:#fff;border-radius:8px;padding:8px 12px;cursor:pointer}
.btn:disabled{background:#1f2a44;color:#9aa0ad;cursor:not-allowed}

/* Inventario */
.inv{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:560px; max-width:95vw;
     background:#0f172a; border:1px solid #1f2a44; border-radius:12px; box-shadow:0 18px 44px rgba(0,0,0,.45); z-index:42}
.inv-h{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #1f2a44;font-weight:700}
.inv-x{width:32px;height:26px;border-radius:6px;border:1px solid #31406e;background:#26325a;color:#fff;cursor:pointer}
.inv-tabs{display:flex;gap:6px; padding:8px 10px; border-bottom:1px solid #1f2a44; flex-wrap:wrap}
.tab{padding:6px 10px; border:1px solid #2a355c; background:#0b1224; color:#d2d7e3; border-radius:8px; cursor:pointer}
.tab.active{ background:#1e293b; border-color:#3b4c78}
.inv-body{padding:10px}
.inv-eq{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:10px}
.slotEq{border:1px dashed #2a355c;border-radius:10px;background:#0b1224;padding:8px;min-height:64px;display:flex;align-items:center;justify-content:space-between}
.slotEq .info{display:flex;align-items:center;gap:8px}
.slotEq .ico{font-size:22px}
.inv-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.invItem{border:1px solid #2a355c;border-radius:10px;background:#0b1224;padding:8px;min-height:98px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;text-align:center}
.invItem .cap{font-size:12px}
.invItem .row{display:flex; gap:6px; flex-wrap:wrap; justify-content:center}
.invItem .act{font-size:12px;padding:6px 8px;border:1px solid #31406e;background:#1e40af;color:#fff;border-radius:8px;cursor:pointer}
.badge{font:700 11px system-ui;color:#93c5fd}
.eqName{color:#e5e7eb;font-weight:600}

/* Abilità (simil inventario) */
.abil{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:480px; max-width:95vw;
  background:#0f172a; border:1px solid #1f2a44; border-radius:12px; box-shadow:0 18px 44px rgba(0,0,0,.45); z-index:43}
.abil-h{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #1f2a44;font-weight:700}
.abil-x{width:32px;height:26px;border-radius:6px;border:1px solid #31406e;background:#26325a;color:#fff;cursor:pointer}
.abil-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:10px}
.abilItem{border:1px solid #2a355c;border-radius:10px;background:#0b1224;padding:10px;display:flex;flex-direction:column;gap:8px}
.abilItem .cap{font-weight:700}
.abilItem .desc{color:#c7cad1;font-size:12px}
.abilItem .row{display:flex;justify-content:space-between;align-items:center}
.abilItem .btn{background:#7c3aed}

/* Target Frame */
.tframe{position:fixed; left:50%; top:8px; transform:translateX(-50%); min-width:240px; max-width:80vw;
  background:rgba(15,23,42,.9); border:1px solid #1f2a44; border-radius:12px; padding:8px 10px; z-index:26; backdrop-filter: blur(3px); display:none}
.trow{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:6px}
.tname{font-weight:700}
.tkind{color:#9ca3af; font-size:12px}
.thp{height:10px; background:#0b1224; border:1px solid #1f2a44; border-radius:6px; overflow:hidden}
.thp>div{height:100%; width:0%; background:#ef4444}
.thpTxt{font-size:12px; margin-top:4px; color:#e5e7eb}

/* DPS panel (alto a destra) */
.dps{position:fixed; right:16px; top:16px; background:rgba(15,23,42,.9); border:1px solid #1f2a44; border-radius:10px; padding:8px 10px; z-index:26}
.dps .h{font-weight:700; margin-bottom:4px}
.dps .v{color:#e5e7eb}

/* Cast bar */
.cast{position:fixed; left:50%; bottom:148px; transform:translateX(-50%); width:60vw; max-width:560px; min-width:220px;
  background:rgba(15,23,42,.9); border:1px solid #1f2a44; border-radius:10px; padding:8px 10px; z-index:26; display:none}
.cast .row{display:flex; justify-content:space-between; align-items:center; margin-bottom:6px}
.cast .name{font-weight:700}
.cast .bar{height:10px; background:#0b1224; border:1px solid #1f2a44; border-radius:6px; overflow:hidden}
.cast .bar>div{height:100%; width:0%; background:#60a5fa}

/* Combat log */
.log{position:fixed; left:16px; bottom:16px; width:320px; max-width:80vw;
  background:rgba(15,23,42,.9); border:1px solid #1f2a44; border-radius:10px; padding:8px 10px; z-index:26}
.log .h{display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; font-weight:700}
.log .b{max-height:180px; overflow:auto; font:12px/1.3 system-ui}
.log .line{margin:2px 0}
.log .dmg{color:#fca5a5}
.log .heal{color:#86efac}
.log .loot{color:#fde68a}
.log .sys{color:#93c5fd}

/* Picker slot */
.picker{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:#0f172a; border:1px solid #1f2a44; border-radius:12px; z-index:45; box-shadow:0 16px 36px rgba(0,0,0,.45); padding:12px; width:320px; max-width:90vw}
.picker h3{margin:0 0 8px 0}
.picker .grid{display:grid; grid-template-columns:repeat(5,1fr); gap:8px}
.pickBtn{padding:10px; background:#1e40af; border:1px solid #31406e; color:#fff; border-radius:10px; cursor:pointer}

/* HUD in-canvas → nascondo i FAB esterni */
#btnAttack, #btnUsePotion, #btnLoot, #atkCdCanvas { display:none !important; }

/* Game Over overlay */
.death{position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.45); z-index:60}
.death.hidden{display:none}
.death-box{background:#0f172a; border:1px solid #1f2a44; padding:14px; border-radius:12px; width:min(420px,92vw); box-shadow:0 18px 44px rgba(0,0,0,.55)}
.death-title{font-weight:800; font-size:18px; margin-bottom:8px}
.death-sub{color:#cbd5e1; margin-bottom:12px}
.death-actions{display:flex; gap:8px; justify-content:flex-end}
